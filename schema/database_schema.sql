-- Creating Tables for Banking Management System

-- Drop existing tables if they exist (to avoid errors when re-running the script) ⭐
-- Drop in reverse order of creation to handle foreign key constraints ⭐

DROP TABLE LOAN;
DROP TABLE ACCOUNT;
DROP TABLE CUSTOMER;
DROP TABLE BRANCH;

-- Branch Table
CREATE TABLE BRANCH (
    BRANCH_CODE VARCHAR2(10) PRIMARY KEY,
    BRANCH_NAME VARCHAR2(50) NOT NULL,
    BRANCH_CITY VARCHAR2(50) NOT NULL
);

-- Customer Table
CREATE TABLE CUSTOMER (
    CUST_NO VARCHAR2(10) PRIMARY KEY,
    NAME VARCHAR2(50) NOT NULL,
    PHONE_NO VARCHAR2(15) NOT NULL,
    CITY VARCHAR2(50) NOT NULL
);

-- Account Table
CREATE TABLE ACCOUNT (
    ACCT_NO VARCHAR2(10) PRIMARY KEY,
    CUST_NO VARCHAR2(10) NOT NULL,
    TYPE VARCHAR2(20) NOT NULL,
    BALANCE NUMBER(12,2) NOT NULL,
    BRANCH_CODE VARCHAR2(10) NOT NULL,
    CONSTRAINT FK_ACCOUNT_CUST FOREIGN KEY (CUST_NO) REFERENCES CUSTOMER(CUST_NO) ON DELETE CASCADE,
    CONSTRAINT FK_ACCOUNT_BRANCH FOREIGN KEY (BRANCH_CODE) REFERENCES BRANCH(BRANCH_CODE) ON DELETE CASCADE,
    CONSTRAINT CHK_ACCOUNT_TYPE CHECK (TYPE IN ('SAVINGS', 'CURRENT', 'FIXED'))
);

-- Loan Table
CREATE TABLE LOAN (
    LOAN_NO VARCHAR2(10) PRIMARY KEY,
    CUST_NO VARCHAR2(10) NOT NULL,
    LOAN_AMOUNT NUMBER(12,2) NOT NULL,
    BRANCH_CODE VARCHAR2(10) NOT NULL,
    CONSTRAINT FK_LOAN_CUST FOREIGN KEY (CUST_NO) REFERENCES CUSTOMER(CUST_NO) ON DELETE CASCADE,
    CONSTRAINT FK_LOAN_BRANCH FOREIGN KEY (BRANCH_CODE) REFERENCES BRANCH(BRANCH_CODE) ON DELETE CASCADE
);

-- Inserting sample data

-- Sample Branch Data
INSERT INTO BRANCH VALUES ('B0001', 'MAIN BRANCH', 'DELHI');
INSERT INTO BRANCH VALUES ('B0002', 'CITY BRANCH', 'MUMBAI');
INSERT INTO BRANCH VALUES ('B0003', 'URBAN BRANCH', 'KOLKATA');
INSERT INTO BRANCH VALUES ('B0004', 'RURAL BRANCH', 'BBSR');
INSERT INTO BRANCH VALUES ('B0005', 'CENTRAL BRANCH', 'DELHI');

-- Sample Customer Data
INSERT INTO CUSTOMER VALUES ('C0001', 'AMIT SHARMA', '9876543210', 'DELHI');
INSERT INTO CUSTOMER VALUES ('C0002', 'PRIYA PATEL', '8765432109', 'MUMBAI');
INSERT INTO CUSTOMER VALUES ('C0003', 'RAJESH KUMAR', '7654321098', 'KOLKATA');
INSERT INTO CUSTOMER VALUES ('C0004', 'SNEHA GUPTA', '6543210987', 'BBSR');
INSERT INTO CUSTOMER VALUES ('C0005', 'VIKRAM SINGH', '5432109876', 'BBSR');
INSERT INTO CUSTOMER VALUES ('C0006', 'NEHA VERMA', '4321098765', 'DELHI');
INSERT INTO CUSTOMER VALUES ('C0007', 'SURESH REDDY', '3210987654', 'MUMBAI');
INSERT INTO CUSTOMER VALUES ('C0008', 'MEENA KUMARI', '2109876543', 'KOLKATA');
INSERT INTO CUSTOMER VALUES ('C0009', 'PRAKASH JAIN', '1098765432', 'BBSR');
INSERT INTO CUSTOMER VALUES ('C0010', 'KAVITA SHARMA', '9087654321', 'BBSR');

-- Sample Account Data
-- C0003 has two accounts
INSERT INTO ACCOUNT VALUES ('A0001', 'C0001', 'SAVINGS', 50000.00, 'B0001');
INSERT INTO ACCOUNT VALUES ('A0002', 'C0002', 'CURRENT', 75000.00, 'B0002');
INSERT INTO ACCOUNT VALUES ('A0003', 'C0003', 'FIXED', 100000.00, 'B0003');
INSERT INTO ACCOUNT VALUES ('A0004', 'C0004', 'SAVINGS', 25000.00, 'B0004');
INSERT INTO ACCOUNT VALUES ('A0005', 'C0005', 'CURRENT', 120000.00, 'B0005');
INSERT INTO ACCOUNT VALUES ('A0006', 'C0006', 'SAVINGS', 35000.00, 'B0001');
INSERT INTO ACCOUNT VALUES ('A0007', 'C0007', 'FIXED', 80000.00, 'B0002');
INSERT INTO ACCOUNT VALUES ('A0008', 'C0008', 'SAVINGS', 7000.00, 'B0003');
INSERT INTO ACCOUNT VALUES ('A0009', 'C0009', 'CURRENT', 65000.00, 'B0004');
--
INSERT INTO ACCOUNT VALUES ('A0010', 'C0003', 'SAVINGS', 45000.00, 'B0005'); 


-- Sample Loan Data
-- C0005 has two loans
INSERT INTO LOAN VALUES ('L0001', 'C0001', 200000.00, 'B0001');
INSERT INTO LOAN VALUES ('L0002', 'C0003', 150000.00, 'B0003');
INSERT INTO LOAN VALUES ('L0003', 'C0005', 300000.00, 'B0005');
INSERT INTO LOAN VALUES ('L0004', 'C0005', 100000.00, 'B0002'); 
INSERT INTO LOAN VALUES ('L0005', 'C0008', 80000.00, 'B0003');

-- Commit changes
COMMIT;

-- Display all tables to verify data
SELECT * FROM BRANCH;
SELECT * FROM CUSTOMER;
SELECT * FROM ACCOUNT;
SELECT * FROM LOAN;